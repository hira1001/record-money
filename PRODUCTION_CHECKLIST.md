# 本番環境デプロイチェックリスト

## ✅ 実装済み項目

### 機能実装
- ✅ 主要機能（Dashboard、OCR、音声入力、Review Queue）
- ✅ データベーススキーマとRLS
- ✅ 認証システム（Google OAuth）
- ✅ API エンドポイント
- ✅ エラーハンドリング（基本的な実装）
- ✅ **モバイルUI改善**（Input Modal のoverflow修正、flexboxレイアウト）
- ✅ **予算設定機能**（インライン編集、Settings アイコン）
- ✅ **カレンダー日付インタラクション**（Daily Detail Modal、円グラフ）
- ✅ **カレンダーナビゲーション強化**（スワイプジェスチャー、大きめボタン）
- ✅ **Bottom Tab Navigation**（Home / Stats / Review）
- ✅ **クレジットカード明細OCR**（バッチ検出API、確認モーダル）

### セキュリティ
- ✅ Row Level Security (RLS) 実装
- ✅ 認証チェック
- ✅ Webhook シークレット検証

### ビルド・デプロイ対策
- ✅ Google Fonts依存の排除（システムフォント使用）
- ✅ ビルド時環境変数エラーの対策
- ✅ Supabase Admin API v2対応（getUserByEmail → listUsers）
- ✅ クライアント初期化のビルド時/ランタイム分離

## ⚠️ 本番環境デプロイ前に必要な修正

### 0. バッチOCR統合の完了
- [x] バッチ検出API実装（`/api/ai/ocr`）
- [x] BatchConfirmModal コンポーネント作成
- [ ] **重複検出ロジックの実装**（既存取引との照合）
- [ ] **InputModal への統合**（バッチ結果のハンドリング）
- [ ] クレジットカード明細での動作テスト

### 1. APIバリデーションの強化
- [ ] POST `/api/transactions` のリクエストボディ検証
- [ ] 入力値のサニタイゼーション
- [ ] レート制限の検討

### 2. エラーハンドリングの改善
- [ ] グローバルエラーページ (`error.tsx`)
- [ ] ローディングページ (`loading.tsx`)
- [ ] エラーログの適切な管理（console.errorの置き換え）

### 3. 環境変数の検証
- [ ] 起動時の環境変数チェック
- [ ] `.env.example` ファイルの作成

### 4. デプロイ設定
- [ ] `next.config.ts` の最適化設定
- [ ] ビルドエラーの確認
- [ ] パフォーマンス最適化

### 5. セキュリティ強化
- [ ] CORS設定
- [ ] レート制限
- [ ] 入力値のサニタイゼーション

### 6. 監視・ログ
- [ ] エラートラッキング（Sentry等）
- [ ] パフォーマンス監視

### 7. ドキュメント
- [ ] API ドキュメント
- [ ] デプロイ手順書
- [ ] 環境変数説明

## 📋 デプロイ前の必須作業

1. **Supabase設定**
   - [ ] データベーススキーマの適用 (`supabase/schema.sql`)
   - [ ] Google OAuth プロバイダーの有効化
   - [ ] RLS ポリシーの確認

2. **環境変数設定**
   - [ ] 本番環境の環境変数設定
   - [ ] シークレットキーの安全な管理

3. **PWAアイコン**
   - [ ] `public/icons/icon-192.png` の作成
   - [ ] `public/icons/icon-512.png` の作成

4. **テスト**
   - [x] ビルドテスト (`npm run build`) ✅ 成功確認済み
   - [ ] 主要機能の動作確認
   - [ ] エッジケースのテスト

## 🚀 デプロイ手順（Vercel推奨）

1. GitHubリポジトリにプッシュ
2. Vercelでプロジェクトをインポート
3. 環境変数を設定
4. デプロイ実行
5. 動作確認

## ⚠️ 注意事項

- 本番環境では `console.error` を適切なログサービスに置き換えることを推奨
- 環境変数は必ずVercelの環境変数設定で管理
- SupabaseのService Role Keyは絶対に公開しないこと

